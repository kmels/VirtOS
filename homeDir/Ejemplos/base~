; base
; Programa base con Critical Section
; 10/03/2010

; rangos de random
set r0 1
set r1 10

; r3 = numero de loops
random r0 r1 r3

; r4 = decrementador para el loop
set r4 1

; r7 = acumulador
set r7 0

'loop'

; ********************
; entry section

; r5 = #semaphore
random r0 r1 r5
wait r5
; ********************


; ********************
; critical section
random r0 r1 r6
add r7 r7 r6
echo "Critical Section"
; ********************

; ********************
; exit section
signal r5
; ********************

sleep

sub r3 r3 r4
echo r3
echo "\n"
jmp r3 loop

end 1
